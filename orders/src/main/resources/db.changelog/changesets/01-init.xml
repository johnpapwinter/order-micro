<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.27.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1" author="johnpapwinter">
        <sql>
            create table if not exists app_users
            (
                id       bigint generated by default as identity
                primary key,
                password varchar(255) not null,
                role     varchar(255) not null,
                username varchar(255) not null
                constraint ukspsnwr241e9k9c8p5xl4k45ih
                unique
                );


            create table if not exists orders
            (
                id                     bigint generated by default as identity
                primary key,
                created_date           timestamp(6),
                last_modification_date timestamp(6),
                customer_name          varchar(255) not null,
                order_date             date         not null,
                order_id               varchar(255) not null
                constraint ukhmsk25beh6atojvle1xuymjj0
                unique,
                order_status           varchar(255) not null
                );


            create table if not exists order_lines
            (
                id                     bigint generated by default as identity
                primary key,
                created_date           timestamp(6),
                last_modification_date timestamp(6),
                price                  double precision not null,
                product_id             varchar(255)     not null,
                quantity               integer          not null,
                order_id               bigint
                constraint fk1smc0s578t2oih21yn9hw6usr
                references orders
                );
        </sql>
    </changeSet>
    <changeSet id="2" author="johnpapwinter">
        <sql>
            create sequence if not exists revinfo_seq
            increment by 50
            start with 1
            no minvalue
            no maxvalue
            cache 1;


            create table if not exists revinfo
            (
                rev      integer not null
                primary key,
                revtstmp bigint
            );

            create table if not exists orders_aud
            (
                id           bigint  not null,
                rev          integer not null
                constraint fkinujab7ljkelflu16c9jjch19
                references revinfo,
                revtype      smallint,
                order_status varchar(255),
                primary key (rev, id)
                );


            create table if not exists order_lines_aud
            (
                id       bigint  not null,
                rev      integer not null
                constraint fkdxs1lpyhdf7qm723fcglfd490
                references revinfo,
                revtype  smallint,
                price    double precision,
                quantity integer,
                order_id bigint,
                primary key (rev, id)
                );
        </sql>
    </changeSet>

</databaseChangeLog>